<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.20.2 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>后分布式时代: 多数派读写的’少数派’实现 - OpenACID Blog</title>
<meta name="description" content="通过减少多数派读写中参与者的数量, 可以实现分布式系统某些特定场景的优化, 以及介绍这些优化对系统可用性产生的影响, 根据什么标准来选择和调整这些参数.">


  <meta name="author" content="张炎泼(xp)">
  
  <meta property="article:author" content="张炎泼(xp)">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="zh_CN">
<meta property="og:site_name" content="OpenACID Blog">
<meta property="og:title" content="后分布式时代: 多数派读写的’少数派’实现">
<meta property="og:url" content="https://blog.openacid.com/algo/quorum/">


  <meta property="og:description" content="通过减少多数派读写中参与者的数量, 可以实现分布式系统某些特定场景的优化, 以及介绍这些优化对系统可用性产生的影响, 根据什么标准来选择和调整这些参数.">







  <meta property="article:published_time" content="2020-10-18T00:00:00+08:00">





  

  


<link rel="canonical" href="https://blog.openacid.com/algo/quorum/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "OpenACID-分布式研究小院",
      "url": "https://blog.openacid.com/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="OpenACID Blog Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<link rel="apple-touch-icon" sizes="180x180"    href="/assets/images/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon/favicon-16x16.png">
<link rel="manifest"                            href="/assets/images/favicon/site.webmanifest">

<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">跳转链接</h2>
  <ul>
    <a href="#site-nav" class="screen-reader-shortcut">转到主导航栏</a>
    <a href="#main" class="screen-reader-shortcut">转到内容</a>
    <a href="#footer" class="screen-reader-shortcut">转到底部</a>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo/icon-lemon-margin.png" alt=""></a>
        
        <a class="site-title" href="/">
          OpenACID Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://github.com/orgs/openacid/people">About Us</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">切换搜索</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">切换菜单</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="http://schema.org/Person">
  
  
  <p>

  
    <div class="author__avatar">
      
        <img src="/assets/images/author/xp.jpg" alt="张炎泼(xp)" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">张炎泼(xp)</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>正在学画画, 主业是码农</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">关注</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <a href="https://drmingdrmer.github.io/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">个人博客</span></a>
          
        
      

      

      

      

      

      

      

      

      

      

      

      
        
          <a href="https://github.com/drmingdrmer" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span>
          </a>
        
      

      

      

      

      

      

      

      

      

      

      
        
          <a href="https://www.weibo.com/drdrxp" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-weibo" aria-hidden="true"></i><span class="label">Weibo</span>
          </a>
        
      

      

      

      

      <!--
  
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  
-->
    </ul>
  </div>

  </p>
  
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="后分布式时代: 多数派读写的’少数派’实现">
    <meta itemprop="description" content="通过减少多数派读写中参与者的数量, 可以实现分布式系统某些特定场景的优化, 以及介绍这些优化对系统可用性产生的影响, 根据什么标准来选择和调整这些参数.">
    <meta itemprop="datePublished" content="2020-10-18T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <br/><h1 id="page-title" class="page__title" itemprop="headline">后分布式时代: 多数派读写的’少数派’实现
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          17 分钟阅读
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> 本文目录</h4></header>
              <ul class="toc__menu">
  <a href="#前言">前言</a>
  <a href="#多数派读写分布式系统的基础">多数派读写:分布式系统的基础</a>
    <ul>
      <a href="#quorum-vs-majority">Quorum vs Majority</a>
    </ul>
  
  <a href="#不是majority的quorum们">不是majority的quorum们</a>
    <ul>
      <a href="#带权重的quorum">带权重的quorum</a>
      <a href="#包含特定元素的quorum">包含特定元素的quorum</a>
      <a href="#45-加-25的quorum">4/5 加 2/5的quorum</a>
      <a href="#hierarchical-quorum-3x3">Hierarchical quorum 3x3</a>
      <a href="#hierarchical-quorum-2xn">Hierarchical quorum 2xn</a>
    </ul>
  
  <a href="#通过设计-quorum-降低延迟">通过设计 quorum 降低延迟</a>
  <a href="#quorum-决定了系统的可用性">quorum 决定了系统的可用性</a>
    <ul>
      <a href="#系统可用性的-quorum-定义">系统可用性的 quorum 定义</a>
      <a href="#quorum-的可用性分析">quorum 的可用性分析</a>
    </ul>
  
  <a href="#应用场景">应用场景</a>
    <ul>
      <a href="#zookeeper-使用-hierarchical-quorum-的例子">zookeeper 使用 hierarchical quorum 的例子</a>
      <a href="#用-quorum-来优化链路选择-边缘存储场景">用 quorum 来优化链路选择: 边缘存储场景</a>
    </ul>
  
  <a href="#总结-quorum-在分布式系统中的意义">总结: quorum 在分布式系统中的意义</a>
</ul>

            </nav>
          </aside>
        
        <p style="font-size: 0.7rem; font-weight: bolder;">
本文链接: <a href="https://blog.openacid.com/algo/quorum/">https://blog.openacid.com/algo/quorum/</a>


</p>


        
          



<img src="/post-res/quorum/quorum-banner-small.jpg" alt="后分布式时代: 多数派读写的'少数派'实现" class="page__hero-image">

        

        <br/><h1 id="前言">前言</h1>

<p>paxos可以看做是2次 <a href="https://zh.wikipedia.org/wiki/Quorum_(分布式系统)" title="多数派读写">多数派读写</a> 完成一次强一致读写.  多数派要求半数以上的参与者(paxos中的Acceptor)接受某笔操作.  但 <a href="https://zh.wikipedia.org/wiki/Quorum_(分布式系统)" title="多数派读写">多数派读写</a> 并不一定需要多于半数的参与者, 分布式系统中某些场合的优化, 可以通过减少参与者数量来完成的.</p>

<br/><h1 id="多数派读写分布式系统的基础">多数派读写:分布式系统的基础</h1>

<p>分布式系统中, 其中一个基础的问题是如何在不可靠硬件(低可用性)基础上构建可靠(高可用性)的服务,
要达成这个目标, 核心的手段就是复制(例如一份数据存3个副本).
而复制过程中的一致性问题, 最后都归结为paxos的解决方案. 这些我们在 <a href="https://blog.openacid.com/algo/paxos" title="可靠分布式系统-paxos的直观解释">paxos的直观解释</a> 中做了详细的介绍.</p>

<p>在 <a href="https://blog.openacid.com/algo/paxos" title="可靠分布式系统-paxos的直观解释">paxos的直观解释</a> 的 <a href="https://blog.openacid.com/algo/paxos/#slide-20" title="paxos的直观解释-20">slide-20</a> 中, 我们了解到, paxos是通过2次 <a href="https://zh.wikipedia.org/wiki/Quorum_(分布式系统)" title="多数派读写">多数派读写</a> 来完成强一致的读写:</p>


  <p>这个方法之所以能工作也是因为多数派写中, 一个系统最多只能允许一个多数派写成功.
paxos也是通过2次多数派读写来实现的强一致.</p>


<p>也就是说, <a href="https://zh.wikipedia.org/wiki/Quorum_(分布式系统)" title="多数派读写">多数派读写</a> 在分布式领域是一个更基础的问题.
在 <a href="https://blog.openacid.com/algo/paxos" title="可靠分布式系统-paxos的直观解释">paxos的直观解释</a> 中也简单介绍了一下 <a href="https://zh.wikipedia.org/wiki/Quorum_(分布式系统)" title="多数派读写">多数派读写</a>:</p>


  <p><strong><a href="https://blog.openacid.com/algo/paxos/#slide-10" title="paxos的直观解释-10">slide-10</a></strong>
为了解决半同步复制中数据不一致的问题, 可以将这个复制策略再做一改进: <strong>多数派读写</strong>: 每条数据必须写入到<strong>半数以上</strong>的机器上. 每次读取数据都必须检查<strong>半数以上</strong>的机器上是否有这条数据.</p>

  <p>在这种策略下, 数据可靠性足够, 宕机容忍足够, 任一机器故障也能读到全部数据.</p>


<p><img src="/post-res/quorum/nwr.jpg" alt="img" /></p>

<p><a href="https://zh.wikipedia.org/wiki/Quorum_(分布式系统)" title="多数派读写">多数派读写</a>, 也可称作 quorum-rw, wikipedia上的描述如下:</p>


  <p>在有冗余数据的分布式存储系统当中，冗余数据对象会在不同的机器之间存放多份拷贝。但是同一时刻一个数据对象的多份拷贝只能用于读或者用于写。</p>

  <p>算法来源于Gifford, 1979。 分布式系统中的每一份数据拷贝对象都被赋予一票。每一个读操作获得的票数必须大于最小读票数（read quorum）（Vr），每个写操作获得的票数必须大于最小写票数（write quorum）(Vw）才能读或者写。如果系统有V票（意味着一个数据对象有V份冗余拷贝），那么最小读写票数(quorum)应满足如下限制：</p>

  <ol>
    Vr + Vw &gt; V
    Vw &gt; V/2
  </ol>


<p>🌰 举个例子, 如果有5个存储节点{a, b, c, d, e},
一笔操作给x赋值为3(x=3) 成功写入了abc 3个节点, 那么另外一个读, 只要联系到任意3个节点,
就一定能读到x=3
这就是安全的.</p>

<p>要联系到至少3个节点, 在某些场景下仍然是昂贵的, 例如一个全球分布的DB,
2个机房之间延迟可能达到上百毫秒.
我们有时希望通过减少必须参与的节点数量, 从而提升系统的性能.
于是我们先从概念开始, 看看quorum-rw中的quorum是什么:</p>

<br/><h2 id="quorum-vs-majority">Quorum vs Majority</h2>

<p>在很多paper中, 是不区分quorum和majority的差别的:</p>

<ul>
  <b>majority就是”多数派”的意思(也就是<strong>多于半数</strong>, ≥⌊n/2⌋+1), 例如5节点中选3个;</b>
  
  <b>quorum, 翻译为”法定人数”( 🤔 WT…?  ), 它不一定是多数, 但需要满足一个条件,
就是任意2个quorum必须有交集(majority已经满足了这个要求).
所以在本文中, <strong>我们将quorum看做majority概念的一个推广; majority是quorum的一个特例</strong>.</b>
  
</ul>

<p>一般我们提到quorum(或majority)时, 都是指一个节点集合Q, 本文中我们把一个系统中所有quorum的集合记为:
<img src="/publish/weibo/algo/quorum/images/mathbb_Q_=_Q_1_Q_2_-e00a2260c10c79813dd9a3e9622c0497.png" style="height: 0.8em" _alt="\mathbb{Q} = \{ Q_1, Q_2... \}"/>,
其中
<img src="/publish/weibo/algo/quorum/images/Q_k_=_a_i_a_j_-79869aee4578404dec9182641864e9e9.png" style="height: 0.8em" _alt="Q_k = \{a_i, a_j...\}"/>
是一个节点(paxos中的Acceptor)的集合, 例如一个三节点系统{a, b, c}, 它的majority的quorum集合:</p>

<img src="/publish/weibo/algo/quorum/images/begin_bmatrix_mathbb_Q_=_a_b_b_c_c_a_a_b_c_end_bmatrix_-dd2931895a0eaf9332057cfc1cce523d.png" style="zoom: 60%; display: block; margin: 0 auto 1.3em auto" _alt="
\begin{bmatrix}
\mathbb{Q} = \{
& \{a, b\}, \\
& \{b, c\}, \\
& \{c, a\}, \\
& \{a, b, c\} \\
\} \\
\end{bmatrix} "/>

<p>现在再回到问题, 要保证quorum-rw的正确性, 就要求一次成功的写入, 必须能成功读取,
从这点看, 过半数这个要求是可以放宽的:</p>

<p>只需要quorum保证<strong>任意2个quorum有交集</strong>就可以.</p>


  <p>在<a href="http://lamport.azurewebsites.net/pubs/pubs.html#paxos-simple" title="paxos made simple">paxos made simple</a>中, 也就是classic paxos的paper中, <a href="http://www.lamport.org/" title="Leslie Lamport">Leslie Lamport</a> 还在使用majority这个名称来表示多数派, 在后面的paper, fast-paxos, generalized paxos中,都换成了quorum这个名词.</p>

  <p>虽然在paper中都是”majority”的意思, 但quorum的适用范围更广.</p>


<p>我们看几个非majority的quorum的例子, 这些quorum都不是传统意义上的majority,
但都可以实现majority同样的功能, 为quorum-rw或paxos提供正确性保证:</p>

<br/><h1 id="不是majority的quorum们">不是majority的quorum们</h1>

<br/><h2 id="带权重的quorum">带权重的quorum</h2>

<p>{a, b, c, d, e} 5个节点中, 把a, b, c三个节点部署到一起: { abc, d, e}(abc必须同时选).
如果选abc, 就记3票, d, e只记一票.</p>

<p>3个成员一共5票, 所有票数过半的集合都是quorum: {abc}, {abc, d}, {abc, e}, {abc, d, e}.
但{d, e} 不是一个quorum, 因为根据我们的定义, 只有2票没有过半.</p>

<p>这样, 任意2个quorum都有交集{abc}.
那么quorum-rw算法, 如果选择任意一个quorum写, 另一个进程选择任意一个quorum读,
都可以实现安全的读写.</p>

<br/><h2 id="包含特定元素的quorum">包含特定元素的quorum</h2>

<p>从上面的例子, 可以直接去掉majority的概念, 就是一类特殊的quorum集合:
<strong><img src="/publish/weibo/algo/quorum/images/mathbb_Q_-5eac308e29708e918ed13a88a4249b74.png" style="height: 0.8em" _alt="\mathbb{Q}"/> 中每个quorum都必须包含某个特定元素</strong>:</p>

<p>如果集群是3个节点{a,b,c}, 定义每个quorum都必须包含a, 那么:
<img src="/publish/weibo/algo/quorum/images/mathbb_Q_=_a_a_b_a_c_a_b_c_-0841771fa0d628b20965c30fcf07f64e.png" style="height: 0.8em" _alt="\mathbb{Q} = \{ \{a\}, \{a,b\}, \{a,c\}, \{a,b,c\} \}"/>.</p>

<p>任意2个quorum都有交集{a}, 用这个quorum定义来运行paxos, 仍然是正确的. (可以试试跑一个之前
<a href="https://blog.openacid.com/algo/paxos" title="可靠分布式系统-paxos的直观解释">paxos的直观解释</a> 中的例子里的paxos)</p>

<br/><h2 id="45-加-25的quorum">4/5 加 2/5的quorum</h2>

<p>在一个5节点集群{a,b,c,d,e} 中, quorum定义为:至少包含4个元素, 或是{a,b}
那么<img src="/publish/weibo/algo/quorum/images/mathbb_Q_-5eac308e29708e918ed13a88a4249b74.png" style="height: 0.8em" _alt="\mathbb{Q}"/> 就是:</p>
<div class="highlighter-rouge"><div class="highlight"><img src="/publish/weibo/algo/quorum/images/tbl_318708580515bdeb111510536f497521.png" style="display: block; margin: 0 auto 1.3em auto" _alt="table"/></div></div>

<p>任一4个元素的quorum都有交集, 任一4元素的quorum也和{a,b}有交集.
能用来跑paxos.</p>

<br/><h2 id="hierarchical-quorum-3x3">Hierarchical quorum 3x3</h2>

<p><a href="https://zookeeper.apache.org/doc/r3.3.2/zookeeperHierarchicalQuorums.html" title="hierarchical quorum">hierarchical quorum</a> 是一个分层的quorum定义,
假设集群有9个节点, 排列成3x3的矩阵, 这里quorum的定义为: <strong>至少包括2行, 每行中至少包含2个节点</strong>.</p>

<p>容易看出任意2个quorum必有交集, 例如 {a1, a2, b1, b2} 和 {b2, b3, c2, c3} 有一个交集{b2}:</p>

<div class="highlighter-rouge"><div class="highlight"><img src="/publish/weibo/algo/quorum/images/tbl_3f1babf33812fceb473a3b0e48714690.png" style="display: block; margin: 0 auto 1.3em auto" _alt="table"/></div></div>

<p>以此quorum定义替代majority, 运行多数派读写或paxos一样是正确的.</p>

<br/><h2 id="hierarchical-quorum-2xn">Hierarchical quorum 2xn</h2>

<p>继续沿用hierarchical quorum 的定义, 但只选2行.
因为一个2节点的系统{x, y}, quorum集合可以是
<img src="/publish/weibo/algo/quorum/images/mathbb_Q_=_x_x_y_-421e1d785a7058c72944e943dab77295.png" style="height: 0.8em" _alt="\mathbb{Q} = \{ \{x\}, \{x, y\} \}"/>
(或
<img src="/publish/weibo/algo/quorum/images/mathbb_Q_=_x_y_y_-492372d566ecbf8d465917cd2f333d38.png" style="height: 0.8em" _alt="\mathbb{Q} = \{ \{x, y\}, \{y\} \}"/>
),
(这里x, y代表一行).</p>

<p>于是这个场景中的quorum 可以描述为:
<strong>包含第一行的majority, 或在每一行都包含一个majority</strong>:</p>

<div class="highlighter-rouge"><div class="highlight"><img src="/publish/weibo/algo/quorum/images/tbl_d5b02f149f055b5bbcb7c6a98baed8fa.png" style="display: block; margin: 0 auto 1.3em auto" _alt="table"/></div></div>

<p>容易看出按照这个规则选出的quorum, 任意2个都有交集.
例如:</p>
<div class="highlighter-rouge"><div class="highlight"><img src="/publish/weibo/algo/quorum/images/tbl_6ad417c03e5bbe85bbe6f6cb821c5a82.png" style="display: block; margin: 0 auto 1.3em auto" _alt="table"/></div></div>
<p>有交集{a1}.</p>

<p><a href="https://raft.github.io/" title="raft">raft</a> 使用了这种quorum定义来完成集群变更, 基于hierarchical
quorum的选主在raft中叫做<a href="https://github.com/peterbourgon/raft/blob/master/JOINT-CONSENSUS.md" title="joint consensus">joint consensus</a>.</p>

<br/><h1 id="通过设计-quorum-降低延迟">通过设计 quorum 降低延迟</h1>

<p>任何一种quorum的定义, 都可以用来替代majority来实现quorum-rw, 或paxos, 并严格保证正确性.
但是, 选择一种quorum, 将直接影响系统的性能和可用性.</p>

<p>首先最直观的结论是, quorum定义中所需的节点个数越少,
完成一次quorum-rw或paxos的消息量就越少, 如果可以选择到更近的节点,
那么整个系统的延迟就有可能会降低.</p>

<br/><h1 id="quorum-决定了系统的可用性">quorum 决定了系统的可用性</h1>

<p>另一方面, 不同的quorum的选择, 会直接影响系统的可用性:</p>

<p><strong>任何一种quorum的选择, 可用性都低于majority的quorum</strong>.</p>

<p>非majority的quorum,
允许更少的可用节点,
以3x3的hierarchical quorum存储为例,
一次写入如果选择了左上的4个节点, 就达到了quorum要求, 只需要不到半数的节点参与.
看似容忍了更多(5个)故障,
但它整体的可用性要低于majority的quorum.</p>

<div class="highlighter-rouge"><div class="highlight"><img src="/publish/weibo/algo/quorum/images/tbl_a77f0500d714666d823e0f941557a686.png" style="display: block; margin: 0 auto 1.3em auto" _alt="table"/></div></div>

<br/><h2 id="系统可用性的-quorum-定义">系统可用性的 quorum 定义</h2>

<p>一个分布式系统的可用性, 可以从一下几方面去考虑, 假设:</p>
<ul>
  集群中的节点随机停机;
  并假设一段时间内一个服务器停机时间比例p=0.01(差不多相当于一个服务器一年有3天左右的时间不在线);
  且停机事件彼此独立.
</ul>

<p>某个时刻, <strong>如果在线的节点集合是一个quorum,
那系统就可用, 可以通过在线节点集合这个quorum完成多数派读写或paxos; 否则就是系统不可用</strong>.</p>


  <p>🌰 例如 {a, b, c} 三个节点, 选择majority的quorum,</p>
  <ul>
    a, b 在线, c停机时, {a, b} 是一个quorum 所以系统可以正常运行.
    如果a在线, b, c都停机, {a} 不是一个quorum, 所以系统这时就不可用了.
  </ul>


<p>因此整个系统的可用性可以定义为: <strong>每个quorum出现的概率之和: <img src="/publish/weibo/algo/quorum/images/P_mathbb_Q_=_P_Q_i_Q_i_mathbb_Q_-f0c95729bfae43418fdc035733a888e3.png" style="height: 0.8em" _alt="P( \mathbb{Q} ) = ΣP(Q_i), Q_i ∈ \mathbb{Q}"/>.
quorum出现的概率是: P(Qᵢ) = (1-p)ˣpⁿ⁻ˣ,
其中x是一个quorum包含的节点个数: x = |Qᵢ|</strong>.</p>


  <p>🌰 对一个三节点的系统 {a, b, c}
majority 的quorum集合 <img src="/publish/weibo/algo/quorum/images/mathbb_M_=_a_b_b_c_c_a_a_b_c_-23cfdbb609c8da2d930c756147033ec6.png" style="height: 0.8em" _alt="\mathbb{M} = \{ \{a, b\}, \{b, c\}, \{c, a\}, \{a, b, c\} \}"/>,
那么3个节点可能出现的所有状态, 以及对应的整个系统是否可用如就如下展示:</p>
  <div class="highlighter-rouge"><div class="highlight"><img src="/publish/weibo/algo/quorum/images/tbl_f3117fe6a30579af47468130e98406f4.png" style="display: block; margin: 0 auto 1.3em auto" _alt="table"/></div>  </div>

  <p>如果选择majority的quorum来构建系统,
那系统可用的概率是后4行状态概率相加:
C(3, 2)(1-p)²p¹ + C(3, 3)(1-p)³p⁰ ~= 1-4p² ~= 0.9996, 大约3个9</p>

  <p>如果选择另一种quorum, 例如去掉{a, b}, 加入{c}, 那这时可用性是第3, 5, 6, 7行相加:
(1-p)¹p² + 2 (1-p)²p¹ + (1-p)³p⁰ = 1-p, 大约2个9,
此时系统中每个quorum都包含c, c在线或停机直接决定了系统的可用性, 所以系统可用性也就是直接等于了c节点的可用性.</p>


<br/><h2 id="quorum-的可用性分析">quorum 的可用性分析</h2>

<p>然后我们来看看为什么非majority的quorum 会降低系统的可用性:</p>

<ul>
  假设majority quorum的集合为 <img src="/publish/weibo/algo/quorum/images/mathbb_M_-a5df6eb8e14d1fd23a6946096d0e8ad4.png" style="height: 0.8em" _alt="\mathbb{M}"/>, 也就是所有大小过半的节点集合;
  对某一个quorum集合<img src="/publish/weibo/algo/quorum/images/mathbb_Q_=_Q_1_Q_2_-0300b7ecf345bff450cb0e64c41512ee.png" style="height: 0.8em" _alt="\mathbb{Q} = \{Q_1, Q_2...\}"/>,
其中 <img src="/publish/weibo/algo/quorum/images/Q_k_=_a_i_a_j_-79869aee4578404dec9182641864e9e9.png" style="height: 0.8em" _alt="Q_k = \{a_i, a_j...\}"/> 是一个节点集合,
Qₓ满足对quorum的定义: 任意2个Qᵢ, Qⱼ交集都不为空: <img src="/publish/weibo/algo/quorum/images/Q_i_Q_j_emptyset-eb293bdee267b02346229797a482b428.png" style="height: 0.8em" _alt="Q_i ∩ Q_j ≠ \emptyset"/>;
  单机停机几率 p = 0.01;
</ul>

<p>我们可以对<img src="/publish/weibo/algo/quorum/images/mathbb_Q_-5eac308e29708e918ed13a88a4249b74.png" style="height: 0.8em" _alt="\mathbb{Q}"/> 做一个变换 <img src="/publish/weibo/algo/quorum/images/f_mathbb_Q_-c0360728970cb8a651d2b8213eb7e794.png" style="height: 0.8em" _alt="f(\mathbb{Q})"/>:</p>

<p>从 <img src="/publish/weibo/algo/quorum/images/mathbb_Q_-5eac308e29708e918ed13a88a4249b74.png" style="height: 0.8em" _alt="\mathbb{Q}"/> 中选择最小的一个Qᵢ: Qᵢ满足∀Qⱼ: |Qᵢ| ≤ |Qⱼ| (如果有多个最小的, 选任意一个), 从<img src="/publish/weibo/algo/quorum/images/mathbb_Q_-5eac308e29708e918ed13a88a4249b74.png" style="height: 0.8em" _alt="\mathbb{Q}"/> 中去掉Qᵢ, 再把Qᵢ的补集加入:</p>

<img src="/publish/weibo/algo/quorum/images/mathbb_Q_=_mathbb_Q_backslash_Q_i_overline_Q_i_-6bedd36c358f20421ac0da8f18960890.png" style="zoom: 60%; display: block; margin: 0 auto 1.3em auto" _alt="\mathbb{Q}' = {\mathbb{Q}} \backslash \{ Q_i\} ∪ \{\overline{Q_i}\}"/>


  <p><strong><img src="/publish/weibo/algo/quorum/images/mathbb_Q_-143566156ff233bc361dca7746848c36.png" style="height: 0.8em" _alt="\mathbb{Q}'"/>也还是一个合法quorum集合</strong>:
因为对任意一个Qⱼ, 如果<img src="/publish/weibo/algo/quorum/images/Q_j_Q_i_-09252ae53dad9594116d5743bd86d558.png" style="height: 0.8em" _alt="|Q_j| ≥ |Q_i|"/>  且 <img src="/publish/weibo/algo/quorum/images/Q_j_Q_i-f01f9ce8e1842fe5b3c6f355f7e417c0.png" style="height: 0.8em" _alt="Q_j ≠ Q_i"/>, 那么Qⱼ一定包含一个不在Qᵢ中的节点,
所以 <img src="/publish/weibo/algo/quorum/images/overline_Q_i_-dc953923411319e68f647380206b40ee.png" style="height: 0.8em" _alt="\overline{Q_i}"/> 和 <img src="/publish/weibo/algo/quorum/images/Q_j-beb195239568309b3e3a0ce19bb5b987.png" style="height: 0.8em" _alt="Q_j"/> 一定有交集.</p>


<p>重复这个步骤直到 <img src="/publish/weibo/algo/quorum/images/mathbb_Q_-5eac308e29708e918ed13a88a4249b74.png" style="height: 0.8em" _alt="\mathbb{Q}"/> 中所有quorum的大小都大于半数. 最后 <img src="/publish/weibo/algo/quorum/images/mathbb_Q_-5eac308e29708e918ed13a88a4249b74.png" style="height: 0.8em" _alt="\mathbb{Q}"/> 就变成了一个<img src="/publish/weibo/algo/quorum/images/mathbb_M_-a5df6eb8e14d1fd23a6946096d0e8ad4.png" style="height: 0.8em" _alt="\mathbb{M}"/> 的子集:
<img src="/publish/weibo/algo/quorum/images/f_mathbb_Q_mathbb_M_-e94281416192cc68e816ac47569d1bab.png" style="height: 0.8em" _alt="f(\mathbb{Q}) ⊆ \mathbb{M}"/></p>

<p>这样, <strong>任何一个 <img src="/publish/weibo/algo/quorum/images/mathbb_Q_-5eac308e29708e918ed13a88a4249b74.png" style="height: 0.8em" _alt="\mathbb{Q}"/> 都可以跟 <img src="/publish/weibo/algo/quorum/images/mathbb_M_-a5df6eb8e14d1fd23a6946096d0e8ad4.png" style="height: 0.8em" _alt="\mathbb{M}"/> 的一个子集建立一个一一映射.
而 <img src="/publish/weibo/algo/quorum/images/mathbb_M_-a5df6eb8e14d1fd23a6946096d0e8ad4.png" style="height: 0.8em" _alt="\mathbb{M}"/> 的子集的可用性一定不大于 <img src="/publish/weibo/algo/quorum/images/mathbb_M_-a5df6eb8e14d1fd23a6946096d0e8ad4.png" style="height: 0.8em" _alt="\mathbb{M}"/> 的可用性</strong>:
<img src="/publish/weibo/algo/quorum/images/P_subset_mathbb_M_P_mathbb_M_-ef721cbecb39ae76f7c9908faa93262f.png" style="height: 0.8em" _alt="P(subset(\mathbb{M})) ≤ P(\mathbb{M})"/>.</p>

<p>而且, <strong>对一个不大于半数的Qᵢ(x = |Qᵢ| ≤ ⌊n⌋/2), 它的补集在随机停机过程中出现的几率更大</strong>:</p>

<img src="/publish/weibo/algo/quorum/images/1-p_xp_n-x_1-p_n-x_p_x_P_Q_i_P_overline_Q_i_P_mathbb_Q_P_f_Q_-017b7aa618c35a0595bfbcd1018dc5ff.png" style="zoom: 60%; display: block; margin: 0 auto 1.3em auto" _alt="(1-p)^xp^{n-x} ≤ (1-p)^{n-x}p^x ⇒ P(Q_i) ≤ P(\overline{Q_i})  ⇒ P(\mathbb{Q}) ≤ P(f(Q))"/>

<p>∴ <img src="/publish/weibo/algo/quorum/images/P_mathbb_Q_P_f_mathbb_Q_P_mathbb_M_-172504fa84b0e9403f6402c683085813.png" style="height: 0.8em" _alt="P(\mathbb{Q}) ≤ P(f(\mathbb{Q})) ≤ P(\mathbb{M})"/>, 即 majority 的 quorum 可靠性最高. 其他任何一种quorum的选择, 即使它允许更多的节点停机, 也只能提供较低的可用性.</p>


  <p>🌰 例如我们算下, 3x3 的 hierarchical quoru m的可用性:</p>
  <ul>
    majority 3 节点的停机概率是: Pm3 = C(3, 2)(1-p)²p + C(3, 3)(1-p)³
    Pm3也就是每个机房的停机概率, 把每个机房看做一个大的节点, 因此3个机房组成的majority quorum的不在线几率是: Ph9 = C(3, 2)(1-Pm3)²Pm3 + C(3, 3)(1-Pm3)³
  </ul>

  <p>我们用 <a href="/post-res/quorum/hierarchical-quorum.py" title="hierarchical-quorum.py">hierarchical-quorum.py</a> 这个小程序计算如下:</p>

  <div class="highlighter-rouge"><div class="highlight"><img src="/publish/weibo/algo/quorum/images/tbl_31a31030bbe67d6f2df4e95ecb7334af.png" style="display: block; margin: 0 auto 1.3em auto" _alt="table"/></div>  </div>

  <p>可以看到hierarchical 3x3 的可用性比majority 9节点的可用性要低1个9.
差不多相当于7节点的majority 可用性.</p>


<br/><h1 id="应用场景">应用场景</h1>

<br/><h2 id="zookeeper-使用-hierarchical-quorum-的例子">zookeeper 使用 hierarchical quorum 的例子</h2>

<p>🌰 <a href="https://zookeeper.apache.org/" title="zookeeper">zookeeper</a> 的配置允许分组的概念, 就是使用了这种quorum定义, 它允许多于半数(5个/9个)节点停机.
例如在我们之前实现的3机房部署中, 就使用了3个机房(DC),
每个机房3个zookeeper实例的配置:</p>

<div class="highlighter-rouge"><div class="highlight"><img src="/publish/weibo/algo/quorum/images/tbl_01ffebc1843f73fb381e58ed1fa82316.png" style="display: block; margin: 0 auto 1.3em auto" _alt="table"/></div></div>

<p><a href="https://zookeeper.apache.org/doc/r3.3.2/zookeeperHierarchicalQuorums.html" title="hierarchical quorum">hierarchical quorum</a> 的一个优势在于在系统可用的状态下,
<strong>只需要联系2个机房就可以完成一次读写</strong>.</p>

<p>我们假设一个接近现实场景:</p>
<ul>
  DC-1 和 DC-2之间的延迟是30ms,
  DC-2 和 DC-3之间也是30ms,
  DC-1 和 DC-3之间比较远, 延迟是60ms,
</ul>

<p>那么选择 hierarchical quorum 所产生的延迟就在一定概率上比majority
quorum的延迟低.</p>

<p>例如, 现在只观察DC-1的写入请求, 最优情况下它只需联系最近的机房(DC-2)来完成一次paxos.
如果宕机2个节点:</p>
<ul>
  hierarchical quorum 需要联系DC-3的条件是: 这2个宕机节点都集中在DC-1或都集中在DC-2时;
  majority quorum     需要联系DC-3的条件是: 这2个宕机节点都不在DC-3时.
</ul>

<p>在宕机2个节点时, hierarchical 只有 majority 40% 的几率延迟达到 60ms;
如果假设单个节点停机几率是p=0.01(1年有3, 4天不在线),
那么9节点宕机2个节点的几率大约是0.0033,
差不多在99分位上, 延迟可以从60ms降低到30ms.</p>

<br/><h2 id="用-quorum-来优化链路选择-边缘存储场景">用 quorum 来优化链路选择: 边缘存储场景</h2>

<p>🌰 传统的存储+CDN架构是用户传输到中心, 之后在下载时, 再通过边缘机房访问,
边缘机房没有则回中心拉取.
且边缘机房之间没有架构级别的关联, 各自在设计上是独立的:</p>

<div class="highlighter-rouge"><div class="highlight"><img src="/publish/weibo/algo/quorum/images/tbl_050912ff03cc2f24322aaaadeeaa599b.png" style="display: block; margin: 0 auto 1.3em auto" _alt="table"/></div></div>

<p>假设我们现在有一个边缘存储的系统: 3个分布在各地的边缘机房eᵢ, 和一个中心机房c.</p>

<div class="highlighter-rouge"><div class="highlight"><img src="/publish/weibo/algo/quorum/images/tbl_babb2d6984e97c23c3c85b9dfb7829a7.png" style="display: block; margin: 0 auto 1.3em auto" _alt="table"/></div></div>

<ul>
  <b>边缘存储的特点是, 一个中心机房c, 一般包含全量数据, 做数据的集中处理, 归档等.
写入一般分散在各个边缘机房, 方便就近接入用户请求.
可以把边缘存储想象成支持本地就近上传的CDN.</b>
  
  <b>边缘跟中心的链路一般很好. 但也会有故障, 边缘跟边缘之间链路质量一般.
因此在处理用户写请求时, 尽可能让边缘机房eᵢ优先选择跟中心机房c同步, 当联系不到中心机房时, fallback到几个边缘机房之间达成一致完成一笔写入.</b>

    <p>边缘存储的架构相比传统存储+CDN的模式, 可以让写入直接落在边缘机房, 省去了一次不必要的带宽.</p>
  
</ul>

<p>在这个例子中, 我们设置中心机房c权重为2; 3个边缘机房, 权重各为1,
quorum定义成带权重的quorum: 一个quorum所包含的节点权重之和至少为3.</p>

<p>假设有1笔写入出现在e₁, 如果它跟中心机房c可以直接通信,
那就通过quorum {e₁, c} 直接完成一次多数派写入.
或者当时跟中心连接抖动, 那么它也可以联系e₂, e₃, 通过quorum {e₁, e₂, e₃}完成一次多数派写入.</p>

<br/><h1 id="总结-quorum-在分布式系统中的意义">总结: quorum 在分布式系统中的意义</h1>

<p>几年前在一个机房里用paxos协同起来的分布式系统, 可以看做是分布式的从0到1的一步, 解决了<strong>分布</strong>问题.</p>

<p>分布式系统近年的发展越来越倾向于异构, 非对等, 大规模的架构共存于一个系统内.
这就对一致性算法提出了新的要求, 现代分布式系统都在尝试解决从1到100的问题:
将可用的系统打造成适应各种复杂场景的可靠系统(而不是简单的单机房几个服务器的单一场景):
系统在节点延迟/故障率/性能等变得越来越复杂的情况下,
系统设计的重心从正确性转移到调优方面,
例如如何让读写倾向于集中在高性能或更稳定的节点上, 或者让读写的流量优先最近的.</p>

<p>通过选择合适的quorum, 我们可以在这些<strong>复杂一些</strong>的系统中, 允许业务在可用性, 延迟, 性能之间做一个权衡:</p>

<ul>
  <b>减少消息数量/延迟, 例如像<strong>zookeeper</strong> hierarchical quorum中的异地多活的例子, 可用性从8个9降低到7个9(假设7个9够用了:D), 换来更稳定的写入延迟: P99 延迟可以从60ms降低到30ms.</b>
  
  <b>使用加权重的quorum, 来实现<strong>边缘存储</strong>这种非对等系统中的链路选择和fallback机制.</b>
  
  <b>或实现更灵活的配置变化, 例如<a href="https://raft.github.io/" title="raft">raft</a> 的成员变更算法.</b>
  
</ul>


        <p style="font-size: 0.7rem; font-weight: bolder;">
本文链接: <a href="https://blog.openacid.com/algo/quorum/">https://blog.openacid.com/algo/quorum/</a>


</p>
<ul class="page-links" style="display:none;">




    
        <li style="font-size:0.7em">
        [raft]: https://raft.github.io/
        </li>
    

    
        <li style="font-size:0.7em">
        [joint consensus]: https://github.com/peterbourgon/raft/blob/master/JOINT-CONSENSUS.md
        </li>
    

    
        <li style="font-size:0.7em">
        [Classic Paxos]: http://lamport.azurewebsites.net/pubs/pubs.html#paxos-simple
        </li>
    

    
        <li style="font-size:0.7em">
        [Fast Paxos]: http://lamport.azurewebsites.net/pubs/pubs.html#fast-paxos
        </li>
    

    
        <li style="font-size:0.7em">
        [paxos的直观解释]: https://blog.openacid.com/algo/paxos
        </li>
    

    
        <li style="font-size:0.7em">
        [Leslie Lamport]: http://www.lamport.org/
        </li>
    

    
        <li style="font-size:0.7em">
        [多数派读写]: https://zh.wikipedia.org/wiki/Quorum_(分布式系统)
        </li>
    

    
        <li style="font-size:0.7em">
        [paxos made simple]: http://lamport.azurewebsites.net/pubs/pubs.html#paxos-simple
        </li>
    

    
        <li style="font-size:0.7em">
        [hierarchical quorum]: https://zookeeper.apache.org/doc/r3.3.2/zookeeperHierarchicalQuorums.html
        </li>
    

    
        <li style="font-size:0.7em">
        [hierarchical-quorum.py]: /post-res/quorum/hierarchical-quorum.py
        </li>
    

    
        <li style="font-size:0.7em">
        [zookeeper]: https://zookeeper.apache.org/
        </li>
    

    
        <li style="font-size:0.7em">
        [slide-10]: https://blog.openacid.com/algo/paxos/#slide-10
        </li>
    

    
        <li style="font-size:0.7em">
        [slide-20]: https://blog.openacid.com/algo/paxos/#slide-20
        </li>
    

</ul>
<p>
<img src="/assets/images/qrcode-hori.jpg" alt="openacid">
</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 标签: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#distributed" class="page__taxonomy-item" rel="tag">distributed</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#majority" class="page__taxonomy-item" rel="tag">majority</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#paxos" class="page__taxonomy-item" rel="tag">paxos</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#quorum" class="page__taxonomy-item" rel="tag">quorum</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#raft" class="page__taxonomy-item" rel="tag">raft</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#replication" class="page__taxonomy-item" rel="tag">replication</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#%E5%88%86%E5%B8%83%E5%BC%8F" class="page__taxonomy-item" rel="tag">分布式</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#%E5%A4%9A%E6%95%B0%E6%B4%BE" class="page__taxonomy-item" rel="tag">多数派</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> 分类: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#algo" class="page__taxonomy-item" rel="tag">algo</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 更新时间:</strong> <time datetime="2020-10-18T00:00:00+08:00">October 18, 2020</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">分享</h4>
  

  <a href="https://twitter.com/intent/tweet?text=%E5%90%8E%E5%88%86%E5%B8%83%E5%BC%8F%E6%97%B6%E4%BB%A3%3A+%E5%A4%9A%E6%95%B0%E6%B4%BE%E8%AF%BB%E5%86%99%E7%9A%84%27%E5%B0%91%E6%95%B0%E6%B4%BE%27%E5%AE%9E%E7%8E%B0%20https%3A%2F%2Fblog.openacid.com%2Falgo%2Fquorum%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="分享 Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.openacid.com%2Falgo%2Fquorum%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="分享 Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fblog.openacid.com%2Falgo%2Fquorum%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="分享 LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/algo/paxos/" class="pagination--pager" title="可靠分布式系统-paxos的直观解释
">上一页</a>
    
    
      <a href="/algo/paxoskv/" class="pagination--pager" title="200行代码实现基于paxos的kv存储
">下一页</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">留下评论</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">猜您还喜欢</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/algo/slimarray/" rel="permalink">slimarray: gzip的压缩率, 即时访问
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          15 分钟阅读
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">slimarray 是一个静态整数压缩数组, 现实数据达到和gzip相当的压缩率, 无需解压就可以直接使用
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/algo/paxoskv/" rel="permalink">200行代码实现基于paxos的kv存储
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          33 分钟阅读
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">用200行代码实现一个基于paxos的kv存储, 以最简洁的形式展示paxos如何运行, 作为 paxos的直观解释 这篇教程中的代码示例部分
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/algo/paxos/" rel="permalink">可靠分布式系统-paxos的直观解释
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          12 分钟阅读
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">没有paxos的一堆机器, 只能叫做分布式; 有paxos协同才叫分布式系统. 咱得把paxos聊开了聊透了
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/tech/bla/programmer-should-know/" rel="permalink">几个无理取闹的coding心得
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 分钟阅读
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">来自一个莫得感情的coding万年户
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      输入您要搜索的关键词...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="输入您要搜索的关键词..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->



<script language="javascript" type="text/x-mathjax-config">
    MathJax.Hub.Config({
      jax: ["input/TeX", "output/SVG"],
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true
        }
    });
</script>
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG"> </script>




<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <strong>关注:</strong>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 OpenACID-分布式研究小院. 技术来自于 <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69976993-2']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://blog.openacid.com/algo/quorum/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/algo/quorum"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://openacid.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  <style> .header-link { display: none !important; } </style> </body >
</html>
