---
title:      "Erasure-Code-æ“¦é™¤ç -3-å®ç°ç¯‡"
authors:
    - xp
categories:
    - storage
tags:
    - storage
    - ec
    - erasure-code
    - distributed
    - replication
    - æ“¦é™¤ç 
    - çº åˆ ç 
    - ä¼½ç½—ç“¦
    - åŸŸ
    - ä¼½ç½—ç“¦åŸŸ
    - GF256

refs:
    - "Vandermonde":      https://en.wikipedia.org/wiki/Vandermonde_matrix                     "Vandermonde matrix"
    - "Cauchy":           https://en.wikipedia.org/wiki/Cauchy_matrix                          "Cauchy matrix"
    - "failure-rate":     https://www.backblaze.com/blog/hard-drive-reliability-stats-q1-2016/ "HDD Failure Rate"
    - "RAID":             https://zh.wikipedia.org/wiki/RAID                                   "RAID"
    - "RAID-5":           https://zh.wikipedia.org/wiki/RAID#RAID_5                            "RAID-5"
    - "RAID-6":           https://zh.wikipedia.org/wiki/RAID#RAID_6                            "RAID-6"
    - "Finite-Field":     https://en.wikipedia.org/wiki/Finite_field                           "Finite-Field"
    - "Galois-Field":     https://en.wikipedia.org/wiki/Finite_field                           "Galois-Field"
    - "Reed-Solomon":     https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction  "Reed-Solomon error correction"
    - "Erasure-Code":     https://en.wikipedia.org/wiki/Erasure_code                           "Erasure-Code"
    - "Prime-Polynomial": https://en.wikipedia.org/wiki/Irreducible_polynomial                 "Prime-Polynomial"
    - "Field-Extension":  https://en.wikipedia.org/wiki/Field_extension                        "Field-Extension"
    - "Complex-Number":   https://en.wikipedia.org/wiki/Irreducible_polynomial#Field_extension "Complex-Number"
    - "Hamming-7-4":      https://en.wikipedia.org/wiki/Hamming(7,4)                           "Hamming(7, 4)"
    - "Generator-Matrix": https://en.wikipedia.org/wiki/Generator_matrix                       "Generator-Matrix"
    - "ç¬¬ä¸€ç¯‡:åŸç†":      https://blog.openacid.com/storage/ec-1                               "ç¬¬ä¸€ç¯‡:Erasure-Code-æ“¦é™¤ç -1-åŸç†ç¯‡"
    - "ç¬¬äºŒç¯‡:å®ç°":      https://blog.openacid.com/storage/ec-2                               "ç¬¬äºŒç¯‡:Erasure-Code-æ“¦é™¤ç -2-å®ç°ç¯‡"
    - "ç¬¬ä¸‰ç¯‡:æé™":      https://blog.openacid.com/storage/ec-3                               "ç¬¬ä¸‰ç¯‡:Erasure-Code-æ“¦é™¤ç -3-æé™ç¯‡"
    - "è´¹é©¬å°å®šç†çš„ç¾¤è®ºçš„è¯æ˜":    https://en.wikipedia.org/wiki/Proofs_of_Fermat%27s_little_theorem#Proofs_using_group_theory "è´¹é©¬å°å®šç†çš„ç¾¤è®ºçš„è¯æ˜"

article:
    image: /post-res/ec-2/ec-3-banner.png

pdf: false

mathjax: true
toc: true
toc_label: æœ¬æ–‡ç›®å½•
toc_sticky: true
---

# ä¹¦æ¥ä¸Šå›

ä¸Šä¸€ç¯‡ [ç¬¬ä¸€ç¯‡:å®ç°][] ä¸­, æˆ‘ä»¬ä»‹ç»å®Œäº†åŸºäºGF(2â¸)ä¼½ç½—ç“¦åŸŸçš„æ ‡å‡†å®ç°ä»¥åŠåšäº†æ­£ç¡®æ€§åˆ†æ,

æˆ‘ä»¬ä¹Ÿæåˆ°:

> åœ¨ECçš„è®¡ç®—ä¸­, ç¼–è§£ç æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„è¿‡ç¨‹,
> å› æ­¤ä¸šç•Œä¹Ÿåœ¨ä¸æ–­å¯»æ‰¾ä¼˜åŒ–çš„æ–¹æ³•, ä¸è®ºä»ç†è®ºç®—æ³•ä¸Šè¿˜æ˜¯ä»è®¡ç®—æœºæŒ‡ä»¤çš„ä¼˜åŒ–ä¸Š,
> äºæ˜¯ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•æŠŠECå®ç°ä¸ºä¸€ä¸ªé«˜æ•ˆçš„å®ç°.

æœ¬æ–‡æˆ‘ä»¬æ¥ä»‹ç», åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ—¶è¿˜éœ€åšå“ªäº›ä¼˜åŒ–,
æ¥å°†ECæ‰“é€ æˆä¸€ä¸ªç¨³å®šé«˜æ•ˆçš„å®ç°.

- [ç¬¬ä¸€ç¯‡:åŸç†] å†ä¸Šä¸€ç¯‡ ğŸ¤”
- [ç¬¬äºŒç¯‡:å®ç°] ä¸Šä¸€ç¯‡ ğŸ¤”
- [ç¬¬ä¸‰ç¯‡:æé™] æˆ‘ä»¬åœ¨è¿™ ğŸ˜


# ç®—æ³•ä¼˜åŒ–

# å·¥ç¨‹ä¼˜åŒ–

# SIMD

# Buffering

# æ•°æ®æ›´æ–°
add=remove

# å‚æ•°é…ç½®

# åƒåœ¾å›æ”¶
simhash

# åˆ†æ

# æ³¢æ¾/æ­£å¤ª

-   éœ€è¦å¯¹å­˜å‚¨ç­–ç•¥è§„åˆ’çš„æ¶æ„å¸ˆ, å¯ä»¥ç›´æ¥å‚è€ƒæ•°å€¼åˆ†æéƒ¨åˆ† [åˆ†æ]({{page.url}}#ec-analysis).

## æ•°æ®æ¢å¤IOä¼˜åŒ–: LRC: [Local-Reconstruction-Code]

å½“ EC è¿›è¡Œæ•°æ®æ¢å¤çš„æ—¶å€™, éœ€è¦kä¸ªå—å‚ä¸æ•°æ®æ¢å¤, ç›´è§‚ä¸Š,
æ¯ä¸ªæ•°æ®å—æŸåéƒ½éœ€è¦kå€çš„IOæ¶ˆè€—.

ä¸ºäº†ç¼“è§£è¿™ä¸ªé—®é¢˜, ä¸€ç§ç•¥å¾®æé«˜å†—ä½™åº¦, ä½†å¯ä»¥å¤§å¤§é™ä½æ¢å¤IOçš„ç®—æ³•è¢«æå‡º:
[Local-Reconstruction-Code], ç®€ç§° LRC.

LRCçš„æ€è·¯å¾ˆç®€å•, åœ¨åŸæ¥çš„ EC çš„åŸºç¡€ä¸Š,
å¯¹æ‰€æœ‰çš„æ•°æ®å—åˆ†ç»„å¯¹æ¯ç»„åœ¨åš1æ¬¡ $ k' + 1 $ çš„ EC.
k' æ˜¯äºŒæ¬¡åˆ†ç»„çš„æ¯ç»„çš„æ•°æ®å—çš„æ•°é‡.



### LRC çš„æ ¡éªŒå—ç”Ÿæˆ

$$
\begin{aligned}
\overbrace{d_1 + d_2 + d_3}^{y_{1,1}} + \overbrace{d_4 + d_5 + d_6}^{y_{1,2}} & = y_1 \\
d_1 + 2d_2 + 2^2d_3 + 2^3d_4 + 2^4d_5 + 2^5d_6                                & = y_2 \\
d_1 + 3d_2 + 3^2d_3 + 3^3d_4 + 3^4d_5 + 3^5d_6                                & = y_3
\end{aligned}
$$

æœ€ç»ˆä¿å­˜çš„å—æ˜¯æ‰€æœ‰çš„æ•°æ®å—: $ d_1, d_2, d_3, d_4, d_5, d_6 $,
å’Œæ ¡éªŒå— $ y_{1,1}, y_{1,2}, y_2, y_3 $.

è¿™é‡Œä¸éœ€è¦ä¿å­˜ $ y_1 $ å› ä¸º $ y_1 = y_{1,1} + y_{1,2} $

å¯¹äº LRCçš„ECæ¥è¯´, å®ƒçš„ç”ŸæˆçŸ©é˜µå‰kè¡Œä¸å˜,
å»æ‰äº†æ ‡å‡†ECçš„ç¬¬k+1è¡Œ, å¤šå‡º2ä¸ªå±€éƒ¨çš„æ ¡éªŒè¡Œ:

$$
\begin{bmatrix}
1 & 0 & 0 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 & 0 & 0 \\
0 & 0 & 1 & 0 & 0 & 0 \\
0 & 0 & 0 & 1 & 0 & 0 \\
0 & 0 & 0 & 0 & 1 & 0 \\
0 & 0 & 0 & 0 & 0 & 1 \\
\hline \\
1 & 1 & 1 & 0 & 0 & 0 \\
0 & 0 & 0 & 1 & 1 & 1 \\
\hline \\
1 & 2 & 2^2 & 2^3 & 2^4 & 2^5 \\
1 & 3 & 3^2 & 3^3 & 3^4 & 3^5 \\
\end{bmatrix}
\times
\begin{bmatrix}
d_1 \\
d_2 \\
d_3 \\
d_4 \\
d_5 \\
d_6
\end{bmatrix} =
\begin{bmatrix}
d_1 \\
d_2 \\
d_3 \\
d_4 \\
d_5 \\
d_6 \\
y_{1,1} \\
y_{1,2} \\
y_2 \\
y_3 \\
\end{bmatrix}
$$



### LRC çš„æ•°æ®æ¢å¤

LRC çš„æ•°æ®æ¢å¤å’Œæ ‡å‡†çš„ECç±»ä¼¼, é™¤äº†2ç‚¹ä¸åŒ:

-   åœ¨é€‰æ‹©æ ¡éªŒå—çš„è¡Œç”Ÿæˆè§£ç çŸ©é˜µçš„æ—¶å€™,
    å¦‚æœæŸç¬¬k+iè¡Œæ²¡æœ‰è¦†ç›–åˆ°ä»»ä½•æŸåçš„æ•°æ®çš„è¯,
    æ˜¯æ— æ³•æä¾›æœ‰æ•ˆæ€§ä¿¡æ¯, éœ€è¦è·³è¿‡çš„.

    ä¾‹å¦‚ $ d_4 $ æŸåæ—¶, ä¸èƒ½åƒæ ‡å‡†ECé‚£æ ·é€‰æ‹©ç¬¬7è¡Œ `1 1 1 0 0 0`
    è¿™è¡Œä½œä¸ºè¡¥å……çš„æ ¡éªŒè¡Œç”Ÿæˆè§£ç çŸ©é˜µ, å¿…é¡»ç•¥è¿‡ç¬¬7è¡Œ, ä½¿ç”¨ç¬¬8è¡Œ.

-   ä¸æ˜¯æ‰€æœ‰çš„æƒ…å†µä¸‹, mä¸ªæ•°æ®æŸåéƒ½å¯ä»¥é€šè¿‡åŠ å…¥mä¸ªæ ¡éªŒè¡Œæ¥æ¢å¤.
    å› ä¸ºLRCçš„ç”ŸæˆçŸ©é˜µæ²¡æœ‰éµå¾ª [Vandermonde] çŸ©é˜µçš„è§„åˆ™,
    ä¸èƒ½ä¿è¯ä»»æ„kè¡Œéƒ½æ˜¯æ»¡ç§©çš„.

#  å·¥ç¨‹ä¼˜åŒ–

æ’æ’­ä¸€æ¡å¹¿å‘Š:
å¾åŒå­¦çš„åšå®¢ä¸­ç»™å‡ºäº†å¾ˆå¥½çš„ECå·¥ç¨‹å®ç°çš„ä»‹ç»,
æ¨è!: [å®ç°é«˜æ€§èƒ½çº åˆ ç å¼•æ“](http://www.templex.xyz/blog/101/writers.html)




##  å¯é æ€§åˆ†æ

åœ¨å¯é æ€§æ–¹é¢, å‡è®¾ EC çš„é…ç½®æ˜¯kä¸ªæ•°æ®å—, mä¸ªæ ¡éªŒå—.
æ ¹æ® EC çš„å®šä¹‰,k+mä¸ªå—ä¸­, ä»»æ„ä¸¢å¤±mä¸ªéƒ½å¯ä»¥å°†å…¶æ‰¾å›.
è¿™ä¸ª EC ç»„çš„ä¸¢å¤±æ•°æ®çš„é£é™©å°±æ˜¯ä¸¢å¤±m+1ä¸ªå—æˆ–æ›´å¤šçš„é£é™©:

$$
\sum_{i=m+1}^{k+m} {k+m \choose i} p^{i} (1-p)^{k+m-i}
$$

è¿™é‡Œpæ˜¯å•å—æ•°æ®ä¸¢å¤±çš„é£é™©,ä¸€èˆ¬é€‰æ‹©ç£ç›˜çš„æ—¥æŸåç‡: å¤§çº¦æ˜¯`0.0001`.
pä¸€èˆ¬å¾ˆå°æ‰€ä»¥è¿‘ä¼¼å°±åªçœ‹ç¬¬1é¡¹:

$$
{k+m \choose m+1} p^{m+1} (1-p)^{k-1}
$$

2ä¸ªæ ¡éªŒå—å’Œ3å‰¯æœ¬çš„å¯é æ€§å¯¹æ¯”(å–m=2):

| k   | m   | ä¸¢æ•°æ®é£é™©                                                      |
| :-- | :-- | :--                                                             |
| 1   | 2   | $ 1 \times 10^{-12} $ (1ä¸ªæ•°æ®å—+2ä¸ªæ ¡éªŒå— å¯é æ€§ å’Œ 3å‰¯æœ¬ç­‰ä»·) |
| 2   | 2   | $ 3 \times 10^{-12} $                                           |
| 3   | 2   | $ 9 \times 10^{-12} $                                           |
| 10  | 2   | $ 2 \times 10^{-10} $ (10+2 å’Œ 12ç›˜æœåŠ¡å™¨çš„ [RAID-6] ç­‰ä»·)      |
| 32  | 2   | $ 5 \times 10^{-9} $                                            |
| 64  | 2   | $ 4 \times 10^{-8} $                                            |

3ä¸ªæ ¡éªŒå—å’Œ4å‰¯æœ¬çš„å¯é æ€§å¯¹æ¯”(å–m=3):

| k   | m   | ä¸¢æ•°æ®é£é™©                                                      |
| :-- | :-- | :--                                                             |
| 1   | 3   | $ 1 \times 10^{-16} $ (1ä¸ªæ•°æ®å—+3ä¸ªæ ¡éªŒå— å¯é æ€§ å’Œ 4å‰¯æœ¬ç­‰ä»·) |
| 2   | 3   | $ 5 \times 10^{-16} $                                           |
| 3   | 3   | $ 2 \times 10^{-15} $                                           |
| 10  | 3   | $ 7 \times 10^{-14} $                                           |
| 32  | 3   | $ 5 \times 10^{-12} $                                           |
| 64  | 3   | $ 7 \times 10^{-11} $                                           |

4ä¸ªæ ¡éªŒå—å’Œ5å‰¯æœ¬çš„å¯é æ€§å¯¹æ¯”(å–m=4):

| k   | m   | ä¸¢æ•°æ®é£é™©                                                      |
| :-- | :-- | :--                                                             |
| 1   | 4   | $ 1 \times 10^{-20} $ (1ä¸ªæ•°æ®å—+4ä¸ªæ ¡éªŒå— å¯é æ€§ å’Œ 5å‰¯æœ¬ç­‰ä»·) |
| 2   | 4   | $ 6 \times 10^{-20} $                                           |
| 3   | 4   | $ 2 \times 10^{-19} $                                           |
| 10  | 4   | $ 2 \times 10^{-17} $                                           |
| 32  | 4   | $ 4 \times 10^{-15} $                                           |
| 64  | 4   | $ 1 \times 10^{-13} $                                           |



## IOæ¶ˆè€—

ä»¥ä¸€ä¸ª EC ç»„æ¥åˆ†æ,
1ä¸ªå—æŸåçš„æ¦‚ç‡æ˜¯ $ p $, è¿™ä¸ªç»„ä¸­æœ‰å—æŸåçš„æ¦‚ç‡æ˜¯:
$ 1 - (1-p)^{k+m} \approx (k+m)p $

æ¯æ¬¡æ•°æ®æŸåéƒ½éœ€è¦è¯»å–å…¨ç»„çš„æ•°æ®è¿›è¡Œæ¢å¤.
ä¸è®º1å—æŸåè¿˜æ˜¯å¤šå—æŸå, æ•°æ®æ¢å¤éƒ½æ˜¯è¯»å–1æ¬¡, è¾“å‡º1æˆ–å¤šæ¬¡.
æ¢å¤æ•°æ®çš„è¾“å‡ºæ¯”è¾ƒå°, 1èˆ¬æ˜¯1, æ‰€ä»¥å¯ä»¥å¿½ç•¥.

æ¯å­˜å‚¨ä¸€ä¸ªå­—èŠ‚ä¸€å¤©æ•°æ®æ¢å¤äº§ç”Ÿçš„ä¼ è¾“é‡æ˜¯(blocksizeæ˜¯ä¸€ä¸ªæ•°æ®å—æˆ–æ ¡éªŒå—çš„å¤§å°):

$$
\frac{(k+m)p \times (k+m) \times blocksize}
{(k+m) \times blocksize} = (k+m)p
$$

ä¹Ÿå°±æ˜¯è¯´, ä½¿ç”¨ EC æ¯å­˜å‚¨`1TB`çš„æ•°æ®,
æ¯å¤©(å› ä¸ºæˆ‘ä»¬å–çš„æ•°æ®æŸåæ¦‚ç‡æ˜¯æŒ‰å¤©è®¡ç®—çš„)ç”¨äºæ•°æ®æ¢å¤è€Œäº§ç”Ÿçš„IOæ˜¯
`k * 0.1GB / TB`

ç£ç›˜çš„IOå¤§è‡´ä¸Šä¹Ÿç­‰åŒäºç½‘ç»œæµé‡, å› ä¸ºå¤§éƒ¨åˆ†å®ç°å¿…é¡»å°†æ•°æ®åˆ†å¸ƒåˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Š.

> NOTE:<br/>
> éšç€ `k`çš„å¢åŠ , æ•´ä½“æˆæœ¬è™½ç„¶ä¼šä¸‹é™(`1+m/k`),
> ä½†æ•°æ®æ¢å¤çš„IOå¼€é”€ä¹Ÿä¼šéšç€k(è¿‘ä¼¼äº)çº¿æ€§çš„å¢é•¿.

ä¾‹å¦‚:

å‡è®¾`k+m = 12`:

å¦‚æœæ•´ä¸ªé›†ç¾¤æœ‰ `100PB` æ•°æ®,
æ¯å¤©ç”¨äºæ¢å¤æ•°æ®çš„ç½‘ç»œä¼ è¾“æ˜¯ `100TB`.

å‡è®¾å•å°å­˜å‚¨æœåŠ¡å™¨çš„å®¹é‡æ˜¯`30TB`,
æ¯å°æœåŠ¡å™¨æ¯å¤©ç”¨äºæ•°æ®æ¢å¤çš„æ•°æ®è¾“å‡ºé‡æ˜¯ `30GB`,
å¦‚æœæ•°æ®æ¢å¤èƒ½å¹³å‡åˆ°æ¯å¤©çš„æ¯1ç§’, æœ€ä½çš„å¸¦å®½æ¶ˆè€—æ˜¯:
`30GB / 86400 sec/day = 3.0Mbps`.

ä½†ä¸€èˆ¬æ¥è¯´æ•°æ®æ¢å¤ä¸ä¼šåœ¨æ—¶é—´ä¸Šå¾ˆå‡åŒ€çš„åˆ†å¸ƒ,
è¿™ä¸ªå¸¦å®½æ¶ˆè€—éœ€è¦é¢„ä¼°10å€åˆ°100å€.




> ECæ“¦é™¤ç ç³»åˆ—:
> - [ç¬¬ä¸€ç¯‡:åŸç†]
> - [ç¬¬äºŒç¯‡:å®ç°]
> - [ç¬¬ä¸‰ç¯‡:æé™]

{% include build_ref %}
